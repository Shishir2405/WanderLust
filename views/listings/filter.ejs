<% layout("layouts/boilerplate") -%>

<link rel="stylesheet" href="/css/index.css" />

<body>

  <div id="currency-modal" class="modal">
    <div class="modal-content">
      <div style="width: 100%">
        <span class="close">&times;</span>
        <p id="curr-head">Currency</p>
      </div>
      <div class="currency-tabs">
        <div class="currency-tab active" data-currency="INR">
          Indian Rupee <br />
          INR – ₹
        </div>
        <div class="currency-tab" data-currency="AUD">
          Australian Dollar <br />
          AUD – $
        </div>
        <div class="currency-tab" data-currency="BRL">
          Brazilian Real <br />
          BRL – R$
        </div>
        <div class="currency-tab" data-currency="BGN">
          Bulgarian Lev <br />
          BGN – лв.
        </div>
        <div class="currency-tab" data-currency="CAD">
          Canadian Dollar <br />
          CAD – $
        </div>
        <div class="currency-tab" data-currency="CLP">
          Chilean Peso <br />
          CLP – $
        </div>
        <div class="currency-tab" data-currency="CNY">
          Chinese Yuan <br />
          CNY – ￥
        </div>
        <div class="currency-tab" data-currency="COP">
          Colombian Peso <br />
          COP – $
        </div>
        <div class="currency-tab" data-currency="CRC">
          Costa Rican Colon <br />
          CRC – ₡
        </div>
        <div class="currency-tab" data-currency="HRK">
          Croatian Kuna <br />
          HRK – kn
        </div>
        <div class="currency-tab" data-currency="CZK">
          Czech Koruna <br />
          CZK – Kč
        </div>
        <div class="currency-tab" data-currency="DKK">
          Danish Krone <br />
          DKK – kr
        </div>
        <div class="currency-tab" data-currency="AED">
          Emirati Dirham <br />
          AED – ﺩ.ﺇ
        </div>
        <div class="currency-tab" data-currency="EUR">
          Euro <br />
          EUR – €
        </div>
        <div class="currency-tab" data-currency="HKD">
          Hong Kong Dollar <br />
          HKD – $
        </div>
        <div class="currency-tab" data-currency="HUF">
          Hungarian Forint <br />
          HUF – Ft
        </div>
        <div class="currency-tab" data-currency="IDR">
          Indonesian Rupiah <br />
          IDR – Rp
        </div>
        <div class="currency-tab" data-currency="ILS">
          Israeli New Shekel <br />
          ILS – ₪
        </div>
        <div class="currency-tab" data-currency="JPY">
          Japanese Yen <br />
          JPY – ¥
        </div>
        <div class="currency-tab" data-currency="MYR">
          Malaysian Ringgit <br />
          MYR – RM
        </div>
        <div class="currency-tab" data-currency="MXN">
          Mexican Peso <br />
          MXN – $
        </div>
        <div class="currency-tab" data-currency="MAD">
          Moroccan Dirham <br />
          MAD
        </div>
        <div class="currency-tab" data-currency="TWD">
          New Taiwan Dollar <br />
          TWD – $
        </div>
        <div class="currency-tab" data-currency="NZD">
          New Zealand Dollar <br />
          NZD – $
        </div>
        <div class="currency-tab" data-currency="NOK">
          Norwegian Krone <br />
          NOK – kr
        </div>
        <div class="currency-tab" data-currency="PEN">
          Peruvian Sol <br />
          PEN – S/
        </div>
        <div class="currency-tab" data-currency="PHP">
          Philippine Peso <br />
          PHP – ₱
        </div>
        <div class="currency-tab" data-currency="PLN">
          Polish Zloty <br />
          PLN – zł
        </div>
        <div class="currency-tab" data-currency="GBP">
          Pound Sterling <br />
          GBP – £
        </div>
        <div class="currency-tab" data-currency="RON">
          Romanian Leu <br />
          RON – lei
        </div>
        <div class="currency-tab" data-currency="SAR">
          Saudi Arabian Riyal <br />
          SAR – SR
        </div>
        <div class="currency-tab" data-currency="SGD">
          Singapore Dollar <br />
          SGD – $
        </div>
        <div class="currency-tab" data-currency="ZAR">
          South African Rand <br />
          ZAR – R
        </div>
        <div class="currency-tab" data-currency="KRW">
          South Korean Won <br />
          KRW – ₩
        </div>
        <div class="currency-tab" data-currency="SEK">
          Swedish Krona <br />
          SEK – kr
        </div>
        <div class="currency-tab" data-currency="CHF">
          Swiss Franc <br />
          CHF
        </div>
        <div class="currency-tab" data-currency="THB">
          Thai Baht <br />
          THB – ฿
        </div>
        <div class="currency-tab" data-currency="TRY">
          Turkish Lira <br />
          TRY – ₺
        </div>
        <div class="currency-tab" data-currency="USD">
          United States Dollar <br />
          USD – $
        </div>
        <div class="currency-tab" data-currency="UYU">
          Uruguayan Peso <br />
          UYU – $U
        </div>
      </div>
    </div>
  </div>

  <div class="tax-toggle toggler" style="margin-top: 1rem">
    <label class="form-check-label" for="flexSwitchCheckDefault"
      >Display total after taxes</label
    >
    <div class="form-check-reverse form-switch switch-container">
      <label class="switch">
        <input type="checkbox" role="switch" id="flexSwitch" />
        <span class="slider">
          <svg
            class="slider-icon"
            viewBox="0 0 32 32"
            xmlns="http://www.w3.org/2000/svg"
            aria-hidden="true"
            role="presentation"
          >
            <path fill="none" d="m4 16.5 8 8 16-16"></path>
          </svg>
        </span>
      </label>
    </div>
  </div>

  <div class="row row-cols-lg-3 row-cols-md-2 row-cols-sm-1 mt-1">
    <% for(let listings of listing){ %>
    <a href="/listings/<%=listings._id%>" id="listing-link">
      <div class="card listing-card mt-3">
        <img
          src="<%=listings.image.url%>"
          class="card-img-top"
          alt="Listing Image"
          style="height: 20rem"
        />

        <div class="card-img-overlay"></div>
        <div class="card-body">
          <p class="card-text">
            <b><%=listings.title %></b> <br />
            <span
            class="price-without-gst"
            data-original-price="<%=listings.price%>"
            ><b> &#x20B9; <%=listings.price.toLocaleString("en-IN")%></b> /
            night</span
          >
          <span
            class="price-with-gst"
            style="display: none"
            data-original-price="<%=listings.price%>"
            ><b>
              &#x20B9; <%= (listings.price * 1.18).toLocaleString("en-IN") %></b
            >/ night</span
          >
          </p>
        </div>
      </div>
    </a>
    <% } %>
  </div>
</body>

<script src="/JS/index.js"></script>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const currencySymbols = {
      INR: "₹",
      AUD: "$",
      BRL: "R$",
      BGN: "лв.",
      CAD: "$",
      CLP: "$",
      CNY: "￥",
      COP: "$",
      CRC: "₡",
      HRK: "kn",
      CZK: "Kč",
      DKK: "kr",
      AED: "ﺩ.ﺇ",
      EUR: "€",
      HKD: "$",
      HUF: "Ft",
      IDR: "Rp",
      ILS: "₪",
      JPY: "¥",
      MYR: "RM",
      MXN: "$",
      MAD: "د.م.",
      TWD: "$",
      NZD: "$",
      NOK: "kr",
      PEN: "S/",
      PHP: "₱",
      PLN: "zł",
      GBP: "£",
      RON: "lei",
      SAR: "SR",
      SGD: "$",
      ZAR: "R",
      KRW: "₩",
      SEK: "kr",
      CHF: "CHF",
      THB: "฿",
      TRY: "₺",
      USD: "$",
      UYU: "$U"
    };

    const conversionRates = {
      INR: 1,
      AUD: 0.018,
      BRL: 0.012,
      BGN: 0.022,
      CAD: 0.016,
      CLP: 0.0011,
      CNY: 0.083,
      COP: 0.00021,
      CRC: 0.0015,
      HRK: 0.011,
      CZK: 0.036,
      DKK: 0.087,
      AED: 0.045,
      EUR: 0.011,
      HKD: 0.094,
      HUF: 3.95,
      IDR: 188.63,
      ILS: 0.041,
      JPY: 1.50,
      MYR: 0.054,
      MXN: 0.20,
      MAD: 0.11,
      TWD: 0.38,
      NZD: 0.020,
      NOK: 0.13,
      PEN: 0.041,
      PHP: 0.68,
      PLN: 0.049,
      GBP: 0.0096,
      RON: 0.054,
      SAR: 0.046,
      SGD: 0.018,
      ZAR: 0.21,
      KRW: 14.92,
      SEK: 0.12,
      CHF: 0.011,
      THB: 0.37,
      TRY: 0.26,
      USD: 0.012,
      UYU: 0.27
    };

    const globeIcon = document.getElementById("globe");
    const modal = document.getElementById("currency-modal");
    const span = document.getElementsByClassName("close")[0];
    const currencyTabs = document.querySelectorAll(".currency-tab");

    globeIcon.onclick = function () {
      modal.style.display = "block";
    };

    span.onclick = function () {
      modal.style.display = "none";
    };

    window.onclick = function (event) {
      if (event.target == modal) {
        modal.style.display = "none";
      }
    };

    currencyTabs.forEach((tab) => {
      tab.onclick = function () {
        const selectedCurrency = this.getAttribute("data-currency");
        updateCurrency(selectedCurrency);
        modal.style.display = "none";
      };
    });

    function updateCurrency(currency) {
      const symbol = currencySymbols[currency];
      const rate = conversionRates[currency];

      document.querySelectorAll(".price-without-gst").forEach((element) => {
        let price = parseFloat(element.dataset.originalPrice);
        let convertedPrice = price * rate;
        element.innerHTML = `<b>${symbol} ${convertedPrice.toLocaleString()}</b> / night`;
      });

      document.querySelectorAll(".price-with-gst").forEach((element) => {
        let price = parseFloat(element.dataset.originalPrice);
        let convertedPrice = price * rate;
        element.innerHTML = `<b>${symbol} ${(convertedPrice * 1.18).toLocaleString()}</b> / night`;
      });
    }
  });
</script>
